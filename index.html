<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>WCG</title>
    <link type="text/css" rel="stylesheet" href="style/style.css"/>
</head>
<body style="background: url(img/bg.png);">
    <div style="text-align: center;" id="tit">
        <p style="font-size: 48px">Winter Card-Game</p>
        <button id="start">开始对战</button>
    </div>
    <img src="img/bruf.png" width="500" height="750" style="position: absolute; left: 50px; top: 250px; text-align: center;" id="pic">
    <img src="img/shanz.png" style="display: none; z-index: 3; position: absolute; left: -250px; top: -76px; transform: rotate(-30deg);" height="2000" width="2000" id="sz">
    <img src="img/0.png" id="big" height="600" width="360" style="position: absolute; left: 5px;">
    <div style="display: none;" id="sp">
        <div style="position: fixed; bottom: 15px;">
            <img src="img/0.png" id="c1" height="280" width="168" onmouseover="show(1)" onmouseout="show(0)">&nbsp;
            <img src="img/0.png" id="c2" height="280" width="168" onmouseover="show(2)" onmouseout="show(0)">&nbsp;
            <img src="img/0.png" id="c3" height="280" width="168" onmouseover="show(3)" onmouseout="show(0)">&nbsp;
            <img src="img/0.png" id="c4" height="280" width="168" onmouseover="show(4)" onmouseout="show(0)">&nbsp;
            <img src="img/0.png" id="c5" height="280" width="168" onmouseover="show(5)" onmouseout="show(0)">&nbsp;
            <img src="img/0.png" id="c6" height="280" width="168" onmouseover="show(6)" onmouseout="show(0)"><br>
            <span style="font-size: 48px;">Diamond: <span id="d"></span></span>
            <button id="skip">skip</button>
        </div>
        <div style="position: absolute; right: 10px; bottom: 10px;">
            <span style="font-size: 48px;">本回合你的数值：+<span style="font-size: 48px;" id="a">0</span>+<span style="font-size: 48px;" id="b">0</span></span>
        </div>
    </div>
    <script>
        var cardcost = [0,1,1,2,8,4,6,3,5,2,3,2,1];//卡牌消费
        var asum = 0;
        var bsum = 0;
        var diamonds = 1,amt = 1; //diamonds最大钻石数，amt目前钻石数
        var pa = [0,1,1,4,8,3,4,3,1,2,5,3,1]; //卡牌提供的a
        var pb = [0,1,1,1,0,2,2,1,4,1,2,2,1]; //卡牌提供的b
        var stat = 0,cards = 12,pcard = 4;//stat是信号，cards卡牌总数
        var names = ["","蜘蛛纸牌列兵","没有吃饱的刘仓","Yuzuru han-nyu","GDY is coming！！！","仓王","呼叫恶委","平行线不香蕉","装X master","文明观猴","深进，就是力量！","博学者爱因仓坦","wjk的冰雪溶液"];
        var pcd = [0,0,0,0,0,0,0,0]; //player card
        var had = [2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];//记录重复
        function insert (i, n) { //在玩家手牌第i个的位置插入第n张卡牌
            if(i == 1) document.getElementById('c1').src = "img/" + ("" + n) + ".png";
            if(i == 2) document.getElementById('c2').src = "img/" + ("" + n) + ".png";
            if(i == 3) document.getElementById('c3').src = "img/" + ("" + n) + ".png";
            if(i == 4) document.getElementById('c4').src = "img/" + ("" + n) + ".png";
            if(i == 5) document.getElementById('c5').src = "img/" + ("" + n) + ".png";
            if(i == 6) document.getElementById('c6').src = "img/" + ("" + n) + ".png";
        }
        function empty() { //判断牌库是否空了
            for (var i = 1; i <= cards; i++) if(had[i] < 2) return false;
            return true;
        }
        function getcard() { //摸一张牌
            if(pcard == 6) {
                alert("手牌满了"); //手牌满了，这里不想全抄ls
                return;
            }
            if(empty()){
                alert("牌库空了"); //牌库空了
                return;
            }
            pcard+=1;
            while(had[pcd[pcard]] == 2) {
                pcd[pcard] = Math.floor(Math.random() * cards) + 1;
            }
            had[pcd[pcard]] += 1;//记录
            insert(pcard, pcd[pcard]);
            return;
        }
        function pop (pos) { //将第pos张卡牌从玩家手中移除
            for (var i = pos; i < pcard; i++) {
                insert(i,pcd[i + 1]);
                pcd[i] = pcd[i + 1];
            }
            pcard-=1;
            pcd[pcard + 1] = 0;
            insert(pcard + 1, 0);
        }
        function fp () { //发牌
            for(var i = 1; i <= 4; i+=1){
                while(had[pcd[i]] == 2) pcd[i] = Math.floor(Math.random() * cards) + 1;//必须不重
                had[pcd[i]] += 1;//记录
                insert(i,pcd[i]);
            }
            document.getElementById('sp').style = "color: blue;";//改变手牌style为可看到，并且位置一定
            document.getElementById('d').innerHTML = diamonds;
        }
        function usecard (num) { //使用第num张手牌
            if(num > pcard) return;
            if(amt >= cardcost[pcd[num]]) {
                alert("您成功使用了" + names[pcd[num]]);
                amt -= cardcost[pcd[num]];
                document.getElementById('d').innerHTML = amt;
                asum += pa[pcd[num]];
                bsum += pb[pcd[num]];
                document.getElementById('a').innerHTML = asum;
                document.getElementById('b').innerHTML = bsum;
                if(pcd[num] == 5){
                    var tmp = asum;
                    asum = bsum;
                    bsum = tmp;
                    document.getElementById('a').innerHTML = asum;
                    document.getElementById('b').innerHTML = bsum;
                }
                if(pcd[num] == 4){
                    if(bsum < asum) {
                        asum -= 5;
                        document.getElementById('a').innerHTML = asum;
                        document.getElementById('b').innerHTML = bsum;
                    }
                }
                if(pcd[num] == 11 && pcard < 6){
                    pcard+=1;
                    insert(pcard, 2);
                    pcd[pcard] = 2;
                }
                if(pcd[num] == 12 && pcard < 6) getcard();
                pop(num);
            } else {
                alert("not enough diamond!");
            }
        }
        document.getElementById('skip').onclick = function () { //跳过回合
            diamonds+=1;
            amt = diamonds;
            document.getElementById('d').innerHTML = amt;
            getcard();
            asum = 0;
            bsum = 0;
            document.getElementById('a').innerHTML = 0;
            document.getElementById('b').innerHTML = 0;
        }
        document.getElementById('c1').onclick = function () {
            usecard(1);
        }
        document.getElementById('c2').onclick = function () {
            usecard(2);
        }
        document.getElementById('c3').onclick = function () {
            usecard(3);
        }
        document.getElementById('c4').onclick = function () {
            usecard(4);
        }
        document.getElementById('c5').onclick = function () {
            usecard(5);
        }
        document.getElementById('c6').onclick = function () {
            usecard(6);
        }
        function bigger (h,w) { //大屏显示由小变大特效
            if(h == 603) return;
            document.getElementById('big').height = h;
            document.getElementById('big').width = w;
            setTimeout(function () {
                bigger(h + 6, w + 4);
            }, 2);
        }
        function show (x) {//大屏幕显示函数
            var tmp;
            if(x == 0) tmp = "img/0.png";
            if(x == 1) tmp = document.getElementById('c1').src;
            if(x == 2) tmp = document.getElementById('c2').src;
            if(x == 3) tmp = document.getElementById('c3').src;
            if(x == 4) tmp = document.getElementById('c4').src;
            if(x == 5) tmp = document.getElementById('c5').src;
            if(x == 6) tmp = document.getElementById('c6').src;
            document.getElementById('big').src = tmp;
            bigger(3, 2);
        }
        function updown (a,uod) {//logo漂浮递归函数
            document.getElementById('pic').style = "position: absolute; left: 600px; z-index: 1; top: " + ("" + a) + "px;";
            setTimeout(function () {
                if(stat == 1) {
                    document.getElementById('pic').style = "display: none;";
                    return;
                }
                var tmp = a;
                a += uod;
                if(a == 219) updown(220, 1);
                else if(a == 241) updown(240, -1);
                else updown(a, uod);
            }, 25);
        }
        updown(230, 1);
        function szt (degr) { //扇子turn
            if(degr == 180) {
                document.getElementById('sz').style = "display: none;";
                fp();
                return;
            }
            if(degr == 0) stat = 1;
            document.getElementById('sz').style = "z-index: 3; position: absolute; left: -250px; top: -76px; transform: rotate(" + ("" + degr) + "deg);";
            setTimeout(function () {
                szt(degr + 1);
            }, 2);
        }
        document.getElementById('start').onclick = function () {
            document.getElementById('tit').style = "display:none;";
            szt(-180);
        }
        
    </script>
</body>
</html>